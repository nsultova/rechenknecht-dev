---
- name: Check if user exists
  getent:
    database: passwd
    key: "{{ username }}"
    fail_key: False
  register: user_check

- name: Create user without sudo
  become: true
  ansible.builtin.user:
    name: "{{ username }}"
    shell: /bin/zsh
    create_home: yes
  when: not user_check.keys()

- name: Remove user 
  become: yes
  ansible.builtin.user:
    name: "{{ username }}"
    state: absent
    remove: yes

#- name: Setup user environment
#  include_role:
#    name: setup
#  vars:
#    ansible_user: {{ user_name }}